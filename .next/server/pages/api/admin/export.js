"use strict";(()=>{var e={};e.id=846,e.ids=[846],e.modules={1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4335:e=>{e.exports=import("csv-stringify")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1602:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>u,routeModule:()=>c});var n=t(1802),s=t(7153),i=t(6249),o=t(4417),d=e([o]);o=(d.then?(await d)():d)[0];let u=(0,i.l)(o,"default"),l=(0,i.l)(o,"config"),c=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/admin/export",pathname:"/api/admin/export",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},3214:(e,r,t)=>{t.d(r,{Z:()=>n});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient},4417:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>d});var n=t(1649),s=t(3214),i=t(4335),o=e([i]);async function d(e,r){let t=await (0,n.getSession)({req:e});if(!t||!t.user)return r.status(401).json({message:"Unauthorized"});if(!await s.Z.admin.findUnique({where:{email:t.user.email}}))return r.status(403).json({message:"Forbidden: Admin access required"});if("GET"!==e.method)return r.status(405).json({message:"Method not allowed"});try{let{type:t,format:a="csv"}=e.query;if(!t||!["employers","job-seekers"].includes(t))return r.status(400).json({message:"Valid export type is required (employers or job-seekers)"});if("csv"!==a)return r.status(400).json({message:"Only CSV format is currently supported"});let n=[],o="",d=[];"employers"===t?(n=await s.Z.employer.findMany({orderBy:{createdAt:"desc"}}),o=`employers-export-${new Date().toISOString().split("T")[0]}.csv`,d=[{key:"companyName",header:"Company Name"},{key:"contactPerson",header:"Contact Person"},{key:"email",header:"Email"},{key:"phone",header:"Phone"},{key:"industry",header:"Industry"},{key:"jobRequirements",header:"Job Requirements"},{key:"workersNeeded",header:"Workers Needed"},{key:"location",header:"Location"},{key:"status",header:"Status"},{key:"createdAt",header:"Submission Date"}]):(n=await s.Z.jobSeeker.findMany({orderBy:{createdAt:"desc"}}),o=`job-seekers-export-${new Date().toISOString().split("T")[0]}.csv`,d=[{key:"firstName",header:"First Name"},{key:"lastName",header:"Last Name"},{key:"email",header:"Email"},{key:"phone",header:"Phone"},{key:"experience",header:"Experience"},{key:"skills",header:"Skills"},{key:"availability",header:"Availability"},{key:"preferredLocation",header:"Preferred Location"},{key:"cvUrl",header:"CV URL"},{key:"status",header:"Status"},{key:"createdAt",header:"Submission Date"}]),n=n.map(e=>({...e,createdAt:new Date(e.createdAt).toISOString().split("T")[0]}));let u=(0,i.stringify)({header:!0,columns:d}),l="";u.on("readable",function(){let e;for(;null!==(e=u.read());)l+=e}),u.on("error",function(e){return console.error("CSV stringify error:",e),r.status(500).json({message:"Error generating CSV"})}),u.on("finish",function(){return r.setHeader("Content-Type","text/csv"),r.setHeader("Content-Disposition",`attachment; filename=${o}`),r.status(200).send(l)}),n.forEach(e=>u.write(e)),u.end()}catch(e){return console.error("Error exporting data:",e),r.status(500).json({message:"Error exporting data"})}}i=(o.then?(await o)():o)[0],a()}catch(e){a(e)}})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1602);module.exports=t})();